# ğŸ“Â ë°°ìš´ ë‚´ìš©

## ê¸°ë³¸ counter êµ¬í˜„

ViewController


```swift
import UIKit
import ReactorKit
import RxCocoa
import RxSwift
    
final class ViewController: UIViewController, StoryboardView {
    @IBOutlet weak var plusButton: UIButton!
    @IBOutlet weak var minusButton: UIButton!
    @IBOutlet weak var valueLabel: UILabel!
    @IBOutlet weak var indicatorView: UIActivityIndicatorView!
    
    var disposeBag = DisposeBag()
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
    }

    func bind(reactor: ViewReactor) {
        // Action
        plusButton.rx.tap
            .map{ ViewReactor.Action.increase } // ????
            .bind(to: reactor.action)
            .disposed(by: disposeBag)
        
        minusButton.rx.tap
            .map { ViewReactor.Action.decrease } // ????
            .bind(to: reactor.action)
            .disposed(by: disposeBag)
        
        // State
        reactor.state.map { $0.value }
            .distinctUntilChanged()
            .map {"\($0)"}
            .bind(to: valueLabel.rx.text)
            .disposed(by: disposeBag)
    }
}
```

<br/>

Reactor


```swift
import ReactorKit
import RxSwift

final class ViewReactor: Reactor {
    // ì‚¬ìš©ìì˜ ì•¡ì…˜
    enum Action {
        case increase
        case decrease
    }
    
    // stateë¥¼ ë°”ê¾¸ëŠ” ê°€ì¥ ì‘ì€ ë‹¨ìœ„
    enum Mutation {
        case increaseValue
        case decreaseValue
    }
    
    struct State {
        var value: Int = 0
    }
    
    let initialState: State = State()
    
    func mutate(action: Action) -> Observable<Mutation> {
        switch action {
        case .increase:
            // ì•¡ì…˜ì— ë”°ë¼ì„œ ë‹¤ìŒ ë®¤í…Œì´ì…˜ì„ ë°˜í™˜
            return Observable.just(Mutation.increaseValue)
        case .decrease:
            return Observable.just(Mutation.decreaseValue)
        }
    }
    
    func reduce(state: State, mutation: Mutation) -> State {
        var newState = state
        switch mutation {
        case .increaseValue:
            newState.value += 1
        case .decreaseValue:
            newState.value -= 1
        }
        return newState
    }
}
```

<br/>

SceneDelegate


```swift
func scene(_ scene: UIScene, willConnectTo session: UISceneSession, options connectionOptions: UIScene.ConnectionOptions) {
        
        guard let _ = (scene as? UIWindowScene) else { return }
        
        // ìƒˆë¡œ reactorê°€ í• ë‹¹ ë°›ì•„ì•¼ bind í•¨ìˆ˜ê°€ í˜¸ì¶œ ë¨.
        let viewController = window?.rootViewController as? ViewController
        let reactor = ViewReactor()
        viewController?.reactor = reactor
        
    }
```

<br/>

## ì¸ë””ì¼€ì´í„°ì™€ ì•ŒëŸ¿ ë·°ì»¨ì„ ì¶”ê°€

ViewController


```swift
import UIKit
import ReactorKit
import RxCocoa
import RxSwift
    
final class ViewController: UIViewController, StoryboardView {
    @IBOutlet weak var plusButton: UIButton!
    @IBOutlet weak var minusButton: UIButton!
    @IBOutlet weak var valueLabel: UILabel!
    @IBOutlet weak var indicatorView: UIActivityIndicatorView!
    
    var disposeBag = DisposeBag()
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
    }

    func bind(reactor: ViewReactor) {
        // Action
        plusButton.rx.tap
            .throttle(.seconds(3), latest: false, scheduler: MainScheduler.instance)
            .map{ ViewReactor.Action.increase } // ????
            .bind(to: reactor.action)
            .disposed(by: disposeBag)
        
        minusButton.rx.tap
            .map { ViewReactor.Action.decrease } // ????
            .bind(to: reactor.action)
            .disposed(by: disposeBag)
        
        // State
        reactor.state.map { $0.value }
            .distinctUntilChanged()
            .map {"\($0)"}
            .bind(to: valueLabel.rx.text)
            .disposed(by: disposeBag)
        
        reactor.state.map { $0.isLoading }
            .distinctUntilChanged()
            .bind(to: indicatorView.rx.isAnimating)
            .disposed(by: disposeBag)
        
        reactor.pulse(\.$alertMessage)
            .compactMap { $0 }
            .subscribe { [weak self] message in
                let alertController = UIAlertController(
                          title: nil,
                          message: message,
                          preferredStyle: .alert
                        )
                        alertController.addAction(UIAlertAction(
                          title: "OK",
                          style: .default,
                          handler: nil
                        ))
                        self?.present(alertController, animated: true)
            }
            .disposed(by: disposeBag)
    }
}
```

<br/>

Reactor


```swift
import ReactorKit
import RxSwift

final class ViewReactor: Reactor {
    // ì‚¬ìš©ìì˜ ì•¡ì…˜
    enum Action {
        case increase
        case decrease
    }
    
    // stateë¥¼ ë°”ê¾¸ëŠ” ê°€ì¥ ì‘ì€ ë‹¨ìœ„
    enum Mutation {
        case increaseValue
        case decreaseValue
        case setLoading(Bool)
        case setAlertMessage(String)
    }
    
    struct State {
        var value: Int = 0
        var isLoading: Bool = false
        @Pulse var alertMessage: String?
    }
    
    let initialState: State = State()
    
    func mutate(action: Action) -> Observable<Mutation> {
        switch action {
        case .increase:
            // ì•¡ì…˜ì— ë”°ë¼ì„œ ë‹¤ìŒ ë®¤í…Œì´ì…˜ì„ ë°˜í™˜
            return Observable.concat([
                Observable.just(Mutation.setLoading(true)),
                Observable.just(Mutation.increaseValue)
                    .delay(.seconds(1), scheduler: MainScheduler.instance),
                Observable.just(Mutation.setLoading(false)),
                Observable.just(Mutation.setAlertMessage("Increased!!"))
            ])
            
        case .decrease:
            return Observable.concat([
                Observable.just(Mutation.setLoading(true)),
                Observable.just(Mutation.decreaseValue)
                    .delay(.seconds(1), scheduler: MainScheduler.instance),
                Observable.just(Mutation.setLoading(false)),
                Observable.just(Mutation.setAlertMessage("Decreased!!"))
            ])
        }
    }
    
    func reduce(state: State, mutation: Mutation) -> State {
        var newState = state
        switch mutation {
        case .increaseValue:
            newState.value += 1
        case .decreaseValue:
            newState.value -= 1
        case let .setLoading(isLoading):
            newState.isLoading = isLoading
        case let.setAlertMessage(message):
            newState.alertMessage = message
        }
        return newState
    }
}
```

<br/>

## í•™ìŠµ

### Rxcocoa Bind

[https://fomaios.tistory.com/entry/RxCocoa-bindë€](https://fomaios.tistory.com/entry/RxCocoa-bind%EB%9E%80)

bind ë‚´ë¶€ì—ëŠ” subscribeë¥¼ í•˜ê³  ìˆìŒ.


```swift
public func bind<Observer: ObserverType>(to observers: Observer...) -> Disposable where Observer.Element == Element {
        self.**subscribe** { event in
            observers.forEach { $0.on(event) }
        }
    }
```

<br/>

<br/>

Binderì— ëŒ€í•´ì„œë„ ë°°ì›Œì•¼ í•¨.

<br/>

[https://madilyn.tistory.com/29](https://madilyn.tistory.com/29)

subscribeë¥¼ í•˜ë©´ weak self ì¨ì¤˜ì•¼ í•˜ëŠ”ë° bind í•˜ë©´ ê·¸ëŸ´ í•„ìš”ê°€ ì—†ìŒ..

[https://hucet.tistory.com/21](https://hucet.tistory.com/21)

<br/>

[https://djgmd1021.tistory.com/175](https://djgmd1021.tistory.com/175)

RxSwift 6 ë¶€í„° cocoaê°€ ì•„ë‹Œ rxswiftì— í¬í•¨ ë˜ëŠ” ë“¯.

<br/>

### tapì´ë‘ mapì´ë‘ ì–´ë–»ê²Œ ì—°ê²° ë˜ì§€?


```swift
minusButton.rx.tap
            .map { ViewReactor.Action.decrease } // ????
            .bind(to: reactor.action)
            .disposed(by: disposeBag)
```

ì•„ì§ ì •í™•í•˜ê²ŒëŠ” ëª¨ë¥´ê² ë‹¤.

ê·¸ëƒ¥ tap í–ˆì„ ë•Œ ë¦¬ì—‘í„°ì˜ ì•¡ì…˜ì´ë‘ ë°”ì¸ë”© í•œë‹¤ê³  ìƒê°í•´ì•¼ ê² ë‹¤.

ë‚˜ì¤‘ì— ë” ê³µë¶€í•´ë³´ëŠ” ê±¸ë¡œ..

<br/>

### distinctUntilChanged

[https://ios-development.tistory.com/175](https://ios-development.tistory.com/175)

ì—°ë‹¬ì•„ì„œ ì¤‘ë³µ ê°’ì´ ì˜¤ë©´ ë¬´ì‹œí•¨.

<br/>


```swift
// Reactor
struct State {
        var value: Int = 0
        var isLoading: Bool = false
        @Pulse var alertMessage: String?
}

// ViewController

        // State
        reactor.state.map { $0.value }
            .**distinctUntilChanged**()
            .map {"\($0)"}
            .bind(to: valueLabel.rx.text)
            .disposed(by: disposeBag)
        
```

state ì „ì²´ë¥¼ ê´€ì°°í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ ìƒíƒœ ê°’ì´ ë³€í™” ë  ë•Œ ë§ˆë‹¤ ì´ë²¤íŠ¸ê°€ ë°œìƒí•¨.

mapìœ¼ë¡œ íŠ¹ì • ìƒíƒœë§Œ ê´€ì°°í•˜ê³  ì´ê²ƒì´ ë°”ë€ ê²½ìš°ë§Œ í•„í„°ë§ì„ í•¨.

<br/>

### Pulse

ì‚¬ì „ì  ì˜ë¯¸: ë§¥ë°•

[https://phillip5094.tistory.com/106](https://phillip5094.tistory.com/106)

`distinctUntilChanged` ë¥¼ ì‚¬ìš©í–ˆì§€ë§Œ..

ê°™ì€ ê°’ì´ ìˆëŠ” ê²½ìš°ê°€ ìˆì„ ìˆ˜ ìˆìŒ. â†’ ì´ë•Œ ì‚¬ìš© í•¨.

`pulse` Property Wrapper í•œ ë³€ìˆ˜ëŠ” ì´ ë³€ìˆ˜ë§Œ ìƒˆë¡œ ê°’ì´ í• ë‹¹ ë˜ì—ˆì„ ë•Œ ì´ë²¤íŠ¸ê°€ ë°œìƒí•¨.

<br/>

pulseë¥¼ distinctUntilChangedë¡œ ë°”ê¾¼ë‹¤ë©´.


```swift
struct State {
        var value: Int = 0
        var isLoading: Bool = false
//        @Pulse var alertMessage: String?
        var alertMessage: String? = ""
    }


reactor.state
            .map { $0.alertMessage }
            .distinctUntilChanged()
            .compactMap { $0 }
            .subscribe { [weak self] message in
                let alertController = UIAlertController(
                    title: nil,
                    message: message,
                    preferredStyle: .alert
                )
                alertController.addAction(UIAlertAction(
                    title: "OK",
                    style: .default,
                    handler: nil
                ))
                self?.present(alertController, animated: true)
            }
            .disposed(by: disposeBag)
```

- ë‹¤ë¥¸ stateê°€ ë°”ë€” ë•Œ ë§ˆë‹¤ ì´ë²¤íŠ¸ ë°œìƒ.

- ì•ì„  ì´ë²¤íŠ¸ì™€ ê°™ì€ ê°’ì´ë©´ `distinctUntilChanged` ì— ê±¸ë¦¼.

	- (ì¹´ìš´í„° ì•±ì˜ ê²½ìš° ì¦ê°€ë‚˜ ê°ì†Œë¥¼ ì—°ì†ìœ¼ë¡œ ëˆ„ë¥´ë©´ ê°™ì€ ê°’ì´ê¸° ë–„ë¬¸ì— ì´ë²¤íŠ¸ í•„í„°ì— ê±¸ë¦¼)

<br/>

pulse PR

[https://github.com/ReactorKit/ReactorKit/pull/176](https://github.com/ReactorKit/ReactorKit/pull/176)

<br/>

### \.(backslash dot)ì´ ë¬´ì—‡ì¸ê°€?

# ğŸ¤”Â ê³ ë¯¼í•œ ì 

<br/>

# âš’ï¸Â íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

<br/>

# ğŸ“šÂ ì°¸ê³  ìë£Œ

<br/>

# âœï¸Â í•œ ì¤„ íšŒê³ 

íŒ€ë…¸ë°” ë•Œ ì²˜ëŸ¼ ë§Œë“¤ë©´ì„œ ê·¸ë•Œ ê·¸ë•Œ í•™ìŠµí•˜ì!

ì˜¤ëŠ˜ ìƒê° ë³´ë‹¤ ì§‘ì¤‘ ì˜í•œë“¯.

ì™„ë²½í•˜ê²Œ ì´í•´í•˜ê³  ë„˜ì–´ê°€ë ¤ê³  í•˜ì§€ ë§ì. ì–´ëŠ ì •ë„ ì´í•´ë˜ë©´ ë„˜ì–´ê°ˆ ì¤„ë„ ì•Œì•„ì•¼ í•œë‹¤.

